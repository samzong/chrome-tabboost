<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TabBoost 测试指南 chrome-tabboost</title>
    <meta name="description" content="本文档提供了TabBoost Chrome扩展的测试框架介绍、测试编写指南和最佳实践。">
    <meta name="keywords" content="Chrome,Extension,Arc,TabBoost,Chrome Extension,Arc Browser,Chrome TabBoost">
    <link rel="stylesheet" type="text/css" href="css/main.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/tocbot.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/media.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/sidebar.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/copy.css?v=1.34.1">
    <link rel="stylesheet" type="text/css" href="css/demo-preview.css?v=1.34.1">
    <script src="js/copy.js?v=1.34.1"></script>
    <script src="js/dark-mode.js?v=1.34.1"></script>
    <script src="js/markdown-style.js?v=1.34.1"></script>
  </head>
  <body id="idoctotop"><a href="#idoctotop" class="gototop">top</a>
    <header class="header">
      <article class="inner warpper" style="max-width:720px;"><a class="logo" href="index.html"><span class="title">chrome-tabboost</span></a>
        <div class="content">
          <ul class="menu">
            <li><a href="index.html" target="" class="">Home</a></li>
            <li><a href="https://github.com/samzong" target="__blank" class="">About</a></li>
          </ul><a href="https://github.com/samzong/chrome-tabboost" target="_blank" rel="noopener noreferrer" title="Github" name="Github" class="github"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg></a>
          <dark-mode permanent=""></dark-mode>
        </div>
      </article>
    </header>
    <div style="max-width:720px;" class="warpper-content warpper notocs">
      <markdown-style theme-auto-switch-disabled="">
        <h1 id="tabboost-测试指南"><a aria-hidden="true" tabindex="-1" href="#tabboost-测试指南" class="anchor"><span class="icon icon-link"></span></a>TabBoost 测试指南</h1>
        <p>本文档提供了TabBoost Chrome扩展的测试框架介绍、测试编写指南和最佳实践。</p>
        <h2 id="目录"><a aria-hidden="true" tabindex="-1" href="#目录" class="anchor"><span class="icon icon-link"></span></a>目录</h2>
        <ol>
          <li><a href="#%E6%B5%8B%E8%AF%95%E6%9E%B6%E6%9E%84">测试架构</a></li>
          <li><a href="#%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95">运行测试</a></li>
          <li><a href="#%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95">编写测试</a></li>
          <li><a href="#%E6%A8%A1%E6%8B%9FChrome-API">模拟Chrome API</a></li>
          <li><a href="#%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87">测试覆盖率</a></li>
          <li><a href="#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90">持续集成</a></li>
          <li><a href="#%E6%B5%8B%E8%AF%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">测试最佳实践</a></li>
        </ol>
        <h2 id="测试架构"><a aria-hidden="true" tabindex="-1" href="#测试架构" class="anchor"><span class="icon icon-link"></span></a>测试架构</h2>
        <p>TabBoost使用以下工具进行测试：</p>
        <ul>
          <li><strong>Jest</strong>: 主要测试框架</li>
          <li><strong>jest-chrome</strong>: 模拟Chrome API的库</li>
          <li><strong>@testing-library/dom</strong>: DOM测试工具</li>
        </ul>
        <p>测试文件组织结构：</p>
        <pre><code class="code-highlight"><span class="code-line line-number" line="1">tests/
</span><span class="code-line line-number" line="2">├── mocks/            # 模拟文件
</span><span class="code-line line-number" line="3">│   ├── fileMock.js
</span><span class="code-line line-number" line="4">│   └── styleMock.js
</span><span class="code-line line-number" line="5">├── setup.js          # Jest全局设置
</span><span class="code-line line-number" line="6">├── unit/             # 单元测试
</span><span class="code-line line-number" line="7">└── integration/      # 集成测试
</span></code><input type="hidden" value="tests/
├── mocks/            # 模拟文件
│   ├── fileMock.js
│   └── styleMock.js
├── setup.js          # Jest全局设置
├── unit/             # 单元测试
└── integration/      # 集成测试
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="运行测试"><a aria-hidden="true" tabindex="-1" href="#运行测试" class="anchor"><span class="icon icon-link"></span></a>运行测试</h2>
        <p>可以使用以下命令运行测试：</p>
        <pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line line-number" line="1"><span class="token comment"># 运行所有测试</span>
</span><span class="code-line line-number" line="2"><span class="token function">npm</span> <span class="token builtin class-name">test</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token comment"># 观察模式（开发时使用）</span>
</span><span class="code-line line-number" line="5"><span class="token function">npm</span> run test:watch
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token comment"># 生成覆盖率报告</span>
</span><span class="code-line line-number" line="8"><span class="token function">npm</span> run test:coverage
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10"><span class="token comment"># CI环境测试</span>
</span><span class="code-line line-number" line="11"><span class="token function">npm</span> run test:ci
</span></code><input type="hidden" value="# 运行所有测试
npm test

# 观察模式（开发时使用）
npm run test:watch

# 生成覆盖率报告
npm run test:coverage

# CI环境测试
npm run test:ci
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="编写测试"><a aria-hidden="true" tabindex="-1" href="#编写测试" class="anchor"><span class="icon icon-link"></span></a>编写测试</h2>
        <h3 id="单元测试"><a aria-hidden="true" tabindex="-1" href="#单元测试" class="anchor"><span class="icon icon-link"></span></a>单元测试</h3>
        <p>单元测试应该专注于测试单个函数或模块的行为，不涉及外部依赖。例如：</p>
        <pre class="language-javascript"><code class="language-javascript code-highlight"><span class="code-line line-number" line="1"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> validateUrl <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'../../src/utils/utils'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'validateUrl函数'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'应该验证合法的HTTP URL'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'http://example.com'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">validateUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">isValid</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">  
</span><span class="code-line line-number" line="10">  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'应该拒绝JavaScript协议URL'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="11">    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'javascript:alert(1)'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">validateUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13">    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">isValid</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="import { validateUrl } from &#x27;../../src/utils/utils&#x27;;

describe(&#x27;validateUrl函数&#x27;, () => {
  test(&#x27;应该验证合法的HTTP URL&#x27;, () => {
    const url = &#x27;http://example.com&#x27;;
    const result = validateUrl(url);
    expect(result.isValid).toBe(true);
  });
  
  test(&#x27;应该拒绝JavaScript协议URL&#x27;, () => {
    const url = &#x27;javascript:alert(1)&#x27;;
    const result = validateUrl(url);
    expect(result.isValid).toBe(false);
  });
});
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="集成测试"><a aria-hidden="true" tabindex="-1" href="#集成测试" class="anchor"><span class="icon icon-link"></span></a>集成测试</h3>
        <p>集成测试应该测试多个组件或模块之间的交互：</p>
        <pre class="language-javascript"><code class="language-javascript code-highlight"><span class="code-line line-number" line="1"><span class="token keyword module">import</span> <span class="token imports">splitViewCore</span> <span class="token keyword module">from</span> <span class="token string">'../../src/js/splitView/splitViewCore'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'分屏视图集成测试'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'切换分屏视图流程'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword control-flow">await</span> splitViewCore<span class="token punctuation">.</span><span class="token method function property-access">toggleSplitView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">    <span class="token comment">// 验证预期行为...</span>
</span><span class="code-line line-number" line="7">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="import splitViewCore from &#x27;../../src/js/splitView/splitViewCore&#x27;;

describe(&#x27;分屏视图集成测试&#x27;, () => {
  test(&#x27;切换分屏视图流程&#x27;, async () => {
    await splitViewCore.toggleSplitView();
    // 验证预期行为...
  });
});
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="模拟chrome-api"><a aria-hidden="true" tabindex="-1" href="#模拟chrome-api" class="anchor"><span class="icon icon-link"></span></a>模拟Chrome API</h2>
        <p>使用<code>jest-chrome</code>模拟Chrome API：</p>
        <pre class="language-javascript"><code class="language-javascript code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// 在测试文件中</span>
</span><span class="code-line line-number" line="2"><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">  chrome<span class="token punctuation">.</span><span class="token property-access">storage</span><span class="token punctuation">.</span><span class="token property-access">sync</span><span class="token punctuation">.</span><span class="token property-access">get</span><span class="token punctuation">.</span><span class="token method function property-access">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">keys<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'value'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">    <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'应该从存储中获取值'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="// 在测试文件中
beforeEach(() => {
  chrome.storage.sync.get.mockImplementation((keys, callback) => {
    const result = { key: &#x27;value&#x27; };
    callback(result);
  });
});

test(&#x27;应该从存储中获取值&#x27;, async () => {
});
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>常用的模拟模式：</p>
        <pre class="language-javascript"><code class="language-javascript code-highlight"><span class="code-line line-number" line="1">chrome<span class="token punctuation">.</span><span class="token property-access">tabs</span><span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token method function property-access">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">queryInfo<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">chrome<span class="token punctuation">.</span><span class="token property-access">runtime</span><span class="token punctuation">.</span><span class="token property-access">sendMessage</span><span class="token punctuation">.</span><span class="token method function property-access">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9"><span class="token comment">// 模拟事件监听器</span>
</span><span class="code-line line-number" line="10">chrome<span class="token punctuation">.</span><span class="token property-access">tabs</span><span class="token punctuation">.</span><span class="token property-access">onActivated</span><span class="token punctuation">.</span><span class="token method function property-access">addListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11">chrome<span class="token punctuation">.</span><span class="token property-access">tabs</span><span class="token punctuation">.</span><span class="token property-access">onActivated</span><span class="token punctuation">.</span><span class="token method function property-access">callListeners</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">tabId</span><span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="chrome.tabs.query.mockImplementation((queryInfo, callback) => {
  callback([{ id: 123, url: &#x27;https://example.com&#x27; }]);
});

chrome.runtime.sendMessage.mockImplementation((message, callback) => {
  callback({ success: true });
});

// 模拟事件监听器
chrome.tabs.onActivated.addListener(listener);
chrome.tabs.onActivated.callListeners({ tabId: 123 });
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="测试覆盖率"><a aria-hidden="true" tabindex="-1" href="#测试覆盖率" class="anchor"><span class="icon icon-link"></span></a>测试覆盖率</h2>
        <p>运行<code>npm run test:coverage</code>后，可以在<code>coverage/</code>目录中查看覆盖率报告。我们的目标覆盖率是：</p>
        <ul>
          <li>语句覆盖率：≥ 60%</li>
          <li>分支覆盖率：≥ 50%</li>
          <li>函数覆盖率：≥ 60%</li>
          <li>行覆盖率：≥ 60%</li>
        </ul>
        <h2 id="持续集成"><a aria-hidden="true" tabindex="-1" href="#持续集成" class="anchor"><span class="icon icon-link"></span></a>持续集成</h2>
        <p>项目使用GitHub Actions进行持续集成，每次推送到main或develop分支以及创建PR时，都会自动运行测试。配置文件位于<code>.github/workflows/tests.yml</code>。</p>
        <p>CI流程包括：</p>
        <ol>
          <li>运行Lint检查</li>
          <li>运行单元测试和集成测试</li>
          <li>生成覆盖率报告</li>
          <li>构建扩展并验证</li>
        </ol>
        <h2 id="测试最佳实践"><a aria-hidden="true" tabindex="-1" href="#测试最佳实践" class="anchor"><span class="icon icon-link"></span></a>测试最佳实践</h2>
        <ol>
          <li>
            <p><strong>测试隔离</strong>: 每个测试应该是独立的，不依赖于其他测试的状态。</p>
          </li>
          <li>
            <p><strong>模拟外部依赖</strong>: 使用jest.mock()模拟所有外部依赖，如Chrome API和第三方服务。</p>
          </li>
          <li>
            <p><strong>可读性</strong>: 测试描述应清晰表明测试的内容和预期结果。使用描述性的test和describe块。</p>
          </li>
          <li>
            <p><strong>边界条件</strong>: 测试函数的边界条件，包括无效输入、空值和异常情况。</p>
          </li>
          <li>
            <p><strong>代码组织</strong>: 将测试辅助函数提取到共享文件中，减少重复代码。</p>
          </li>
          <li>
            <p><strong>异步测试</strong>: 对于Promise和异步函数，使用async/await语法使测试更易读。</p>
          </li>
          <li>
            <p><strong>测试覆盖率</strong>: 定期检查覆盖率报告，找出未测试的代码路径。</p>
          </li>
          <li>
            <p><strong>重构友好</strong>: 编写测试时关注行为而非实现细节，使测试在重构时仍然有效。</p>
          </li>
          <li>
            <p><strong>持续更新</strong>: 在添加新功能时同时编写测试，保持测试套件的更新。</p>
          </li>
          <li>
            <p><strong>快速反馈</strong>: 测试应该快速运行，提供即时反馈。避免不必要的延迟和等待。</p>
          </li>
        </ol>
      </markdown-style>
    </div>
    <script src="js/demo-preview.js?v=1.34.1"></script>
    <div class="footer warpper" style="max-width:720px;">Copyright © 2025 <a href="https://github.com/samzong" target="_blank">samzong</a><br></div>
    <script src="js/tocbot.js?v=1.34.1"></script>
  </body>
</html>
